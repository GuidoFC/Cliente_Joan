<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script src="./view/view.js"></script>
    <script src="./model/model.js"></script>
    <script src="./service/service.js"></script>
    <script>
      // Primero crearemos el tag de div con id = app
      createDiv();
      createImg();

      putImg(1);

      const alfabeto = createAllLetters();

      function createDivToWords(alfabeto) {
        // TODO necesito crear un div padre y luego muchos div para cada letra
        // contendor padre

        const getDivContendor = createContendorDiv();

        // crear los div dentro del contendor padre

        createAllDivForEachLetter(getDivContendor);
        styleDefault(getDivContendor);
        // to do an array with 4 words y hacer una que aparezca
        const palabraAdivinar = createWordsToGuess(getDivContendor);
        // befote to do this i want to save this word in another variable
        const savePalabraAdivinar = palabraAdivinar;

        // tranform all the words in this character "_"
        transformWordsToUnderscore(palabraAdivinar);
        //

        addFunctionsAllButtons(savePalabraAdivinar);

        function addFunctionsAllButtons(savePalabraAdivinar) {
          // select all the button with class -> classButton
          // console.table(allButtons);
          const allButtons = document.querySelectorAll(".classButton");
          for (let i = 0; i < allButtons.length; i++) {
            allButtons[i].addEventListener("click", disableButton);
            // con esta función anomina evito que se ejecute inmediatamente la función!!!!!!
            // Entender que significa esto de event
            // Pasamos el evento click para poder acceder al botón clicado
            allButtons[i].addEventListener("click", (event) =>
              getTextButton(savePalabraAdivinar)
            );
          }
        }

        // get text of the button
        function getTextButton(savePalabraAdivinar) {
          // Entender que significa esto de event
          const anyButton = event.target; // 'event.target' es el botón que fue clicado

          const getLetter = anyButton.textContent;
          const palabraCriptada = savePalabraAdivinar;

          if (thereIsThisLetter(getLetter, palabraCriptada)) {
            console.log("pintar verde");
            // cambiar el color de un solo boton
            anyButton.style.background = "rgb(111, 247, 112)";
            // desvelaremos una casilla
            unveilLetter(getLetter, palabraCriptada);
            function unveilLetter(getLetter, palabraCriptada) {
              const matchLetter = [];
              console.log(palabraCriptada);
              for (let i = 0; i < palabraCriptada.length; i++) {
                if (palabraCriptada.charAt(i) === getLetter) {
                  matchLetter.push(i);
                }
              }

              console.log(
                "Posicion de las letras de ordenador, con la letra O elegida"
              );
              const indexMult2 = multiplicarX2(matchLetter);
              function multiplicarX2(matchLetter) {
                const getNumber = [];
                for (let i = 0; i < matchLetter.length; i++) {
                  const getIndex = Number(matchLetter[i]) * 2;
                  getNumber.push(getIndex);
                }
                return getNumber;
              }

              console.log(indexMult2);
              // Tengo la palabra asi: _ _ _ _
              // Tengo que contar los guiones

              const getpalabaElegidaFormatoGuion =
                document.querySelector("#palabaElegida").textContent;

              // Transformaremos el string en un Array
              const arrayFormaGuion = [];
              for (let i = 0; i < getpalabaElegidaFormatoGuion.length; i++) {
                arrayFormaGuion.push(getpalabaElegidaFormatoGuion[i]);
              }

              // TODO!!!!!

              for (let i = 0; i < indexMult2.length; i++) {
                const indexChange = indexMult2[i];
                arrayFormaGuion[indexChange] = getLetter;
              }

              console.log(arrayFormaGuion);

              let reconstruirPalabra = "";
              // volver atransforma de Array to String
              for (let i = 0; i < arrayFormaGuion.length; i++) {
                reconstruirPalabra = reconstruirPalabra + arrayFormaGuion[i];
              }
              debugger;
              console.log(reconstruirPalabra);
              document.querySelector("#palabaElegida").textContent =
                reconstruirPalabra;

              // cuando haga match hacer un cambio
            }
          } else {
            wrongGuess(anyButton);
            
          }
        }
      }

      

      function thereIsThisLetter(getLetter, palabraCriptada) {
        const getWord = getLetter;
        for (let i = 0; i < palabraCriptada.length; i++) {
          if (palabraCriptada.charAt(i) === getLetter) {
            return true;
          }
        }
        return false;
      }

      function changePhoto() {
        // Tengo que saber el numero de la foto
        const getImg = document.querySelector("#photo");

        const getNumberActualPhoto = getNumberPhoto(getImg);

        console.log(getNumberActualPhoto);

        // Convertimos a número y sumamos 1 para obtener el siguiente número
        const incrementNumber = Number(getNumberActualPhoto) + 1;
        // incrementar ese numero para cambiar de foto
        // TODO no puedo pasar a otra foto
        // debugger;
        const getSrcIMG = getImg.src;
        const pngActual = getNumberActualPhoto + ".PNG";
        const nextPng = incrementNumber + ".PNG";
        const newSrc = getSrcIMG.replace(pngActual, nextPng);
        // Asignamos el nuevo `src` a la imagen para que cambie
        getImg.src = newSrc;
      }

      function getNumberPhoto(getImg) {
        const getSrcIMG = getImg.src;
        // getImg.src =
        //   "http://127.0.0.1:5500/Ex%202.%20Penjat/assests/img/" +
        //   incrementNumber +
        //   ".PNG";
        // console.log(getSrcIMG);
        // He hecho esta resta porque se que si empiezo por el final, siempre obtendre el numero
        // el problema seria si hubiera mas de 9 fotos
        const getPosition = Number(getSrcIMG.length - 5);
        const getNumber = getSrcIMG.charAt(getPosition);
        return getNumber;
      }

      createDivToWords(alfabeto);
    </script>
  </body>
</html>
